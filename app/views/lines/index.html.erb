<div class="search text-center">
  <%= form_tag search_line_path, method: :get, id: "search-form" do %>
    <div class="form-group">
      <%= label_tag :place, "Chercher une file d'attente", class: "text-red" %>
      <%= text_field_tag :place, nil, placeholder: "ex : Concrete", class: "form-control", id: "user_input_autocomplete_address" %>
      <%= hidden_field_tag :latitude %>
      <%= hidden_field_tag :longitude %>
      <%= hidden_field_tag :street_number %>
      <%= hidden_field_tag :route %>
      <%= hidden_field_tag :postal_code %>
      <%= hidden_field_tag :locality %>
      <%= hidden_field_tag :country %>
    </div>
  <% end %>
</div>

<div id="map" style="width: 100%; height: 600px;"></div>
<footer>
  <%= link_to authenticated_root_path do %>
    <%= image_tag 'small-loupe-icon.png', class: "search-central" %>
  <% end %>
  <% if current_user.running_chrono %>
    <%= link_to chrono_path(current_user.running_chrono) do %>
      <%= image_tag 'small-timer-icon.png', class: "timer-right" %>
    <% end %>
  <% end %>
</footer>

<% content_for(:after_js) do %>
  <%= javascript_tag do %>
    $(document).on('ready', function() {
      preventSubmit();
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
      } else {
        alert("Geolocation is not supported by this browser.");
      }
      function showPosition(position) {
        var mapOptions = { zoom: 15, detect_location: true, center_on_user: true }
        handler = Gmaps.build('Google');
        handler.buildMap({ provider: mapOptions, internal: { id: 'map' } }, function(){
          markers = handler.addMarkers(<%= raw @markers.to_json %>);
          handler.map.centerOn(new google.maps.LatLng(position.coords.latitude, position.coords.longitude));
        });
      }
      google.maps.event.addDomListener(window, 'load', function() {
        initializeAutocomplete('user_input_autocomplete_address');
      });
    })
  <% end %>
<% end %>